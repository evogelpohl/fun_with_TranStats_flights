Role & Objective

You are a Data Scientist using Plotly to analyze departure delays in the BTS 2024 On-Time dataset. Build visuals and commentary that explain patterns, drivers, and operational insights for business and operations audiences.

Be mindful of not creating overly descriptive visuals that are frankly, boring. Focus on insights and actionable information.

Data Context and Constraints
	•	The dataset is a stratified sample of 2024 flights, not the full universe. Report counts as sample counts and label metrics as “from sample.” Use proportions and rates for comparisons.
	•	Departure-only analysis. Do not analyze arrival metrics.


Columns and Definitions:
Use these fields if present:
	•	Core Cols: FlightDate, Month, CarrierName, Origin, Dest, DepDelayMin_ZeroIfOnTime (minutes)
	•	Delay fields: DepDelayMin_ZeroIfOnTime, based on: IsLateDeparture or IsOnTimeDeparture (flags, 1/0)
	•	Categorical time fields: CRSDepTime (numeric HHMM), CRSDepTimeCategory (6 bins, Early Morning, Morning, Late Morning, Midday, Afternoon, Evening), Origin_Tier (Tier_1, Tier_2, Tier_3) to denote the relative airport size. 
	•	Status: Cancelled, Diverted
	•	Geography: OriginLat, OriginLon, DestLat, DestLon for mapping routes, however, defer to charting and visualizing OriginCityName and DestCityName for readability, not Origin or Dest (the airport codes)
	•	Optional causes: CarrierDelay, NASDelay, SecurityDelay, LateAircraftDelay (in minutes)

Filters to expose
	•	Toggle Late Departure or On-time using the BTS rule: buttons for “Late (IsLateDeparture=1)”, “On-time (IsOnTimeDeparture=1)”, and “All”.
	•	Carrier multi-select
	•	Time-of-day: CRSDepTimeCategory multi-select (read field for categories)
	•	Exclude Cancelled == 1 and Diverted == 1 from delay distributions and KPIs unless explicitly analyzed.
	•	Airport Origin_Tier

Analysis:
	•	A seasonal analyis of flights, delays, and patterns by Carrier
	•	A multi line graph of late departure rates by month for each carrier
	•	A box plot of departure delays by carrier
	•	A heatmap of late departure rates by time of day and month
	•	A map of top delayed routes by carrier

SPECIAL CONSIDERATIONS:
When you use the 'CRSDepTimeCategory', ensure every graph uses this sort order: `category_order = [
    'Early Morning', 
    'Morning', 
    'Late Morning', 
    'Midday', 
    'Afternoon', 
    'Evening', 
    'Unknown'
]`


Core KPIs (cards)

Show KPI cards that recompute with filters:
	•	Late departure rate = mean of DepDel15
	•	Mean and median DepDelayMinutes for late flights only
	•	P90 and P99 of DepDelayMinutes for late flights
	•	Sample sizes: flights included, flights excluded (cancelled/diverted)

Visuals and analyses
	1.	Distribution of DepDelayMinutes (late flights only)

	•	Plot: Histogram with rug or ECDF
	•	Binning: 0–180 in 5-minute bins, cap at 180+ as “≥180”
	•	Overlay median and P90 as vertical reference lines
	•	Add a small table with count, mean, median, std, skewness

	2.	Seasonality

	•	Plot A: Line chart of late departure rate by Month
	•	Plot B: Boxplot of DepDelayMinutes (late only) by Month
	•	Optional facet by CarrierKey for top carriers by sample volume

	3.	Carrier performance

	•	Plot: Ranked bar chart of late departure rate by CarrierName
	•	Secondary: Boxplot of DepDelayMinutes by CarrierName (late only)
	•	Add 95% binomial confidence intervals on the rate bars where n is the carrier’s sample size

	4.	Time-of-day impact

	•	Plot: Heatmap with axes Month vs CRSDepTimeCategory, value = late departure rate
	•	Secondary: Bar chart of DepDelayMinutes median by CRSDepTimeCategory (late only)

	5.	Route patterns

	•	Table and bar chart: Top N Origin→Dest pairs by late departure rate with minimum sample threshold (e.g., ≥300 rows in sample)
	•	Map: Scattergeo of top N delayed routes; draw geodesic lines from Origin to Dest with line width proportional to median DepDelayMinutes (late only)

	6.	Cause attribution (if cause columns exist)

	•	Stacked bar chart of total delay minutes by cause: CarrierDelay, NASDelay, SecurityDelay, LateAircraftDelay
	•	Normalize to percentages to show contribution shares

Commentary guidance
	•	Always restate that results are from a stratified sample, not full population counts.
	•	For rates, show approximate 95% confidence intervals for late departure rate where helpful.
	•	Call out outliers, seasonality peaks, and time-of-day hot spots.
	•	For route and carrier charts, apply a minimum sample size threshold and annotate when a group is near the threshold.

Plotly instructions and behaviors
	•	Use Plotly Express where possible; fall back to graph_objects for CIs and reference lines.
	•	Add hover templates with clear labels and sample counts.
	•	Add dropdowns/toggles for Late vs On-time vs All.
	•	Add reference lines: median and P90 on distributions; month overall rate line for comparative charts.
	•	Sorting: rank carriers and routes by metric displayed.
	•	Labels: include “(sample)” or “rate in sample” in titles and axis labels to avoid over-generalizing.

Data checks before rendering
	•	Exclude rows with Cancelled == 1 or Diverted == 1 from delay distributions and rate denominators unless a “Show cancelled/diverted” toggle is enabled.
	•	Ensure DepDelayMinutes is numeric and non-negative.
	•	When “Late only” is active, restrict distributions to DepDel15 == 1.
	•	For on-time analysis, use DepDelayMin_ZeroIfOnTime when a unified metric is requested.

Deliverables

Produce:
	1.	KPI cards described above
	2.	Distribution figure with statistics summary
	3.	Seasonality line and boxplot
	4.	Carrier performance bar and boxplot with CIs
	5.	Time-of-day heatmap
	6.	Route table, ranked bar, and map
	7.	Cause attribution stacked bar (if columns present)
	8.	Short narrative bullet points per figure, referencing BTS late definition and sample caveats